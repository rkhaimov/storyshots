---
sidebar_position: 3
---

# UI режим

UI режим — это специальное приложение, которое предоставляет интерактивный доступ к запуску, обновлению и просмотру
историй.

Общий интерфейс выглядит следующим образом:

![.](assets/main-aria.png)

## Навигатор

В левой части расположен навигатор, с помощью которого можно просмотреть список всех историй:

![.](assets/navigator.png)

## Превью

При клике на историю открывается интерактивный режим предпросмотра:

![.](assets/preview.png)

Во время предпросмотра `storyshots` выполняет следующие действия:

1. Очищает зону от предыдущей истории.
2. Запускает функцию `render` истории и отображает её на экране.
3. Выполняет действия, описанные в `act`.

Таким образом, состояние приложения автоматически подготавливается, предоставляя разработчику готовое окружение для
работы.

:::note
`storyshots` позволяет проводить разработку и отладку, используя инструменты браузера, не выходя из режима написания
тестов. Это делает возможной **TDD**-разработку.
:::

:::tip
Чтобы перезапустить предпросмотр, достаточно кликнуть на выбранную историю ещё раз.
:::

## Запуск

При наведении курсора на историю или группу историй появляются дополнительные действия, включая запуск тестового
сценария:

![.](assets/run-action.png)

:::note
Запуск тестового сценария выполняется только для устройства по умолчанию.
:::

После запуска формируется актуальный слепок, и отображается его статус относительно эталона:

![.](assets/fresh.png)

:::note
При первом запуске теста слепок помечается как "новый" (синяя точка).
:::

## Журнал

Журнал — это часть слепка поведения. Его можно просмотреть, кликнув на пункт "Records":

![.](assets/fresh-records.png)

Кнопка "Accept" в верхнем правом углу позволяет принять слепок журнала, сделав его частью эталона:

![.](assets/accepted-journal.png)

:::note
Принятый журнал помечается зелёной галочкой.
:::

## Снимки

Снимки экранов составляют основную часть слепка поведения AUT. Чтобы просмотреть конкретный снимок, выберите его
название в списке:

![.](assets/fresh-screenshot.png)

:::note
"FINAL" — это название по умолчанию для снимков, которые создаются автоматически после завершения действий в истории.
:::

Кнопка "Accept" позволяет принять снимок как эталон, подтверждая текущее поведение AUT как корректное.

![.](assets/accepted-screenshot.png)

:::note
История считается пройденной, только если весь её слепок совпадает с эталоном.
:::

:::tip
Журналы и снимки можно принимать по отдельности.
:::

## Массовые действия

`storyshots` позволяет запускать несколько историй одновременно:

![.](assets/bulk-run.png)

После выполнения формируются слепки, которые можно принять все сразу:

![.](assets/bulk-accept.png)

Результат:

![.](assets/bulk-accept-result.png)

## Изменение журнала

Рассмотрим сценарий регресса. Изначально журнал выглядит так:

![.](assets/actual-journal.png)

Удалим вызов из кода:

```ts title="До"
externals.analytics.log('worked hard');
```

```ts title="После"
// externals.analytics.log('worked hard');
```

После перезапуска теста:

![.](assets/fail-journal.png)

`storyshots` обнаружил разницу между актуальным журналом и эталоном. Красный крестик указывает на несоответствие.
Откроем журнал:

![.](assets/diff-journal.png)

Здесь видна разница между актуальным и эталонным поведением. Кнопка "Accept" позволяет принять текущий слепок как
корректный.

## Изменение снимков

Рассмотрим историю с промежуточным снимком:

![.](assets/inter-screens.png)

Изменим текст на странице:

```txt title="До"
Account Balance (RUB)
```

```txt title="После"
My balance (RUB)
```

После перезапуска:

![.](assets/failed-screens.png)

Каждый снимок содержит разницу. Пример:

![.](assets/inter-diff-screen.png)

Слева — актуальный снимок (синяя обводка), справа — эталонный (зелёная обводка).

## Ошибки

Если сгенерировать слепок не удаётся, например, из-за отсутствия элемента, история помечается восклицательным знаком:

![.](assets/error-story.png)

Чтобы узнать подробности, кликните на статус в правом верхнем углу:

![.](assets/status-btn.png)

Откроется панель с деталями ошибки:

![.](assets/error-details.png)

:::note
`storyshots` использует библиотеку `playwright` для взаимодействия с интерфейсом.
:::

:::tip
Вкладка "Failures" содержит список историй, слепки которых отличаются от эталонных.
:::

## Локатор

Для упрощения работы с селекторами используется инструмент "Локатор". Он находится на панели инструментов и выглядит как
глаз:

![.](assets/loc-story.png)

При наведении на элемент отображается рекомендуемый селектор:

![.](assets/loc-help.png)

:::note
Режим копирования селектора находится в разработке.
:::

:::warning Внимание
Локатор не всегда предлагает оптимальный селектор. Рекомендуется использовать [семантические локаторы](/patterns/actor#семантические-селекторы).
:::

## Выбор устройства

Если `storyshots` настроен для нескольких устройств, можно выбрать устройство через панель конфигурации:

![.](assets/config-btn.png)

Панель выглядит так:

![.](assets/config-panel.png)

Выберите устройство, например, "mobile":

![.](assets/mobile-sel.png)

Теперь слепки будут формироваться для выбранного устройства:

![.](assets/mobile-fresh.png)

:::note
Журналы также уникальны для каждого устройства.
:::

:::tip
Тестируемое приложение и устройство можно рассматривать как отдельное AUT.
:::

## Полный запуск

Для приложений с несколькими устройствами доступен режим полного запуска:

![.](assets/run-comp.png)

Результат:

![.](assets/devices-fresh.png)

:::warning Внимание
Использование более двух устройств может значительно увеличить время выполнения тестов.
:::

## Эмуляция

При выборе мобильного устройства предпросмотр не изменяется:

![.](assets/def-preview.png)

Чтобы включить эмуляцию, поставьте галочку в панели конфигурации:

![.](assets/em-preview.png)

:::note
`storyshots` не эмулирует устройство полностью, а только устанавливает заданные размеры экрана.
:::
